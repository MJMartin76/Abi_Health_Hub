<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Notes - Abigail's Health Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>ğŸŒ¿ Abigail's Health Hub</h1>
        <p>Your Daily Guide to Feeling Better</p>
    </header>

    <div class="container">
        <nav>
            <a href="index.html">
                <span class="icon">ğŸ </span>
                <span>Home</span>
            </a>
            <a href="schedule.html">
                <span class="icon">ğŸ“…</span>
                <span>My Schedule</span>
            </a>
            <a href="personalcare.html">
                <span class="icon">ğŸ’š</span>
                <span>Personal Care</span>
            </a>
            <a href="meals.html">
                <span class="icon">ğŸ½ï¸</span>
                <span>Meal Plans</span>
            </a>
            <a href="healthinfo.html">
                <span class="icon">ğŸ“š</span>
                <span>My Health Info</span>
            </a>
            <a href="tracker.html">
                <span class="icon">âœ…</span>
                <span>Daily Tracker</span>
            </a>
            <a href="journal.html">
                <span class="icon">ğŸ“–</span>
                <span>My Journal</span>
            </a>
            <a href="progress.html">
                <span class="icon">ğŸ“Š</span>
                <span>Progress History</span>
            </a>
            <a href="notes.html" class="active">
                <span class="icon">ğŸ“</span>
                <span>Weekly Notes</span>
            </a>
            <a href="tips.html">
                <span class="icon">ğŸ’¡</span>
                <span>Tips & Reminders</span>
            </a>
            <a href="emergency.html">
                <span class="icon">ğŸš¨</span>
                <span>When to Tell Mindy</span>
            </a>
        </nav>

        <main>
            <h2>ğŸ“ Weekly Notes & Reflection</h2>

            <div class="alert-box">
                <p>Track your progress each week. Your notes are automatically saved! These also appear in your journal so you have a complete record.</p>
            </div>

            <div class="card card-border-blue">
                <h3>ğŸ“… Select Week</h3>
                <div class="date-picker">
                    <input type="date" id="weekly-notes-date" />
                    <button onclick="loadWeeklyNotes()">Load This Week</button>
                    <button onclick="setThisWeek()">This Week</button>
                </div>
                <p style="margin-top: 1rem; color: #666;">Viewing notes for week of: <strong id="current-week-date"></strong></p>
            </div>

            <div class="card card-border-green">
                <h3>Energy Patterns</h3>
                <p style="margin-bottom: 0.5rem;"><strong>Best time of day:</strong></p>
                <input type="text" id="energyBest" placeholder="e.g., Mid-morning after breakfast" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1.1rem; font-family: 'Atkinson Hyperlegible', sans-serif; margin-bottom: 1rem;">
                
                <p style="margin-bottom: 0.5rem;"><strong>Worst time of day:</strong></p>
                <input type="text" id="energyWorst" placeholder="e.g., Late afternoon around 3-4 PM" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1.1rem; font-family: 'Atkinson Hyperlegible', sans-serif; margin-bottom: 1rem;">
                
                <p style="margin-bottom: 0.5rem;"><strong>Activities that help:</strong></p>
                <input type="text" id="energyHelp" placeholder="e.g., Short walks, gentle stretching" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1.1rem; font-family: 'Atkinson Hyperlegible', sans-serif; margin-bottom: 1rem;">
                
                <p style="margin-bottom: 0.5rem;"><strong>Activities that drain:</strong></p>
                <input type="text" id="energyDrain" placeholder="e.g., Too much screen time, skipping rest periods" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1.1rem; font-family: 'Atkinson Hyperlegible', sans-serif;">
            </div>

            <div class="card card-border-orange">
                <h3>Gout & Tremor Tracking</h3>
                <p style="margin-bottom: 0.5rem;"><strong>Joint pain level (1-10):</strong></p>
                <input type="number" id="painLevel" min="1" max="10" placeholder="1-10" style="width: 150px; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1.1rem; font-family: 'Atkinson Hyperlegible', sans-serif; margin-bottom: 1rem;">
                
                <p style="margin-bottom: 0.5rem;"><strong>Tremor severity (1-10):</strong></p>
                <input type="number" id="tremorLevel" min="1" max="10" placeholder="1-10" style="width: 150px; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1.1rem; font-family: 'Atkinson Hyperlegible', sans-serif; margin-bottom: 1rem;">
                
                <p style="margin-bottom: 0.5rem;"><strong>What triggered tremors:</strong></p>
                <input type="text" id="tremorTrigger" placeholder="e.g., Anxiety about exercise, feeling rushed" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1.1rem; font-family: 'Atkinson Hyperlegible', sans-serif; margin-bottom: 1rem;">
                
                <p style="margin-bottom: 0.5rem;"><strong>What helped calm tremors:</strong></p>
                <input type="text" id="tremorCalm" placeholder="e.g., Deep breathing, sitting down, reassurance" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1.1rem; font-family: 'Atkinson Hyperlegible', sans-serif; margin-bottom: 1rem;">
                
                <p style="margin-bottom: 0.5rem;"><strong>Average water intake this week:</strong></p>
                <input type="number" id="waterIntake" placeholder="oz per day" style="width: 150px; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1.1rem; font-family: 'Atkinson Hyperlegible', sans-serif;">
            </div>

            <div class="card card-border-blue">
                <h3>Therapy Progress</h3>
                <p style="margin-bottom: 0.5rem;"><strong>Speech therapy wins:</strong></p>
                <input type="text" id="speechWins" placeholder="e.g., Spoke more clearly, completed all exercises" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1.1rem; font-family: 'Atkinson Hyperlegible', sans-serif; margin-bottom: 1rem;">
                
                <p style="margin-bottom: 0.5rem;"><strong>OT exercises completed:</strong></p>
                <input type="text" id="otCompleted" placeholder="e.g., Fine motor skills, daily living tasks" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1.1rem; font-family: 'Atkinson Hyperlegible', sans-serif; margin-bottom: 1rem;">
                
                <p style="margin-bottom: 0.5rem;"><strong>PT improvements:</strong></p>
                <input type="text" id="ptImprovements" placeholder="e.g., Stronger legs, better balance" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1.1rem; font-family: 'Atkinson Hyperlegible', sans-serif; margin-bottom: 1rem;">
                
                <p style="margin-bottom: 0.5rem;"><strong>Skills I'm mastering:</strong></p>
                <input type="text" id="skillsMastering" placeholder="e.g., Walking without tremors, speaking confidently" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1.1rem; font-family: 'Atkinson Hyperlegible', sans-serif;">
            </div>

            <div class="card card-border-purple">
                <h3>Goals for Next Week</h3>
                <p style="margin-bottom: 0.5rem;"><strong>Goal 1:</strong></p>
                <input type="text" id="goal1" placeholder="e.g., Drink 90+ oz water every day" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1.1rem; font-family: 'Atkinson Hyperlegible', sans-serif; margin-bottom: 1rem;">
                
                <p style="margin-bottom: 0.5rem;"><strong>Goal 2:</strong></p>
                <input type="text" id="goal2" placeholder="e.g., Complete all rest periods" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1.1rem; font-family: 'Atkinson Hyperlegible', sans-serif; margin-bottom: 1rem;">
                
                <p style="margin-bottom: 0.5rem;"><strong>Goal 3:</strong></p>
                <input type="text" id="goal3" placeholder="e.g., Practice positive self-talk" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1.1rem; font-family: 'Atkinson Hyperlegible', sans-serif;">
            </div>

            <div style="text-align: center; margin: 2rem 0;">
                <button onclick="saveWeeklyNotes()" style="padding: 1rem 3rem; border: none; border-radius: 12px; background: linear-gradient(135deg, #66bb6a, #81c784); color: white; font-size: 1.3rem; font-weight: 700; cursor: pointer; font-family: 'Atkinson Hyperlegible', sans-serif; box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);">
                    ğŸ’¾ Save Weekly Notes
                </button>
            </div>

            <div class="card card-border-green">
                <h3>ğŸ“š Past Weekly Notes</h3>
                <div id="past-weekly-notes"></div>
            </div>
        </main>
    </div>

    <script src="AirtableService.js"></script>
    <script src="app.js"></script>
    <script>
        let currentWeekDate = getTodayString();

        function setThisWeek() {
            currentWeekDate = getTodayString();
            document.getElementById('weekly-notes-date').value = currentWeekDate;
            loadWeeklyNotes();
        }

        function getWeekStartDate(dateString) {
            const date = new Date(dateString + 'T12:00:00');
            const day = date.getDay();
            const diff = date.getDate() - day; // Get Sunday of that week
            const sunday = new Date(date.setDate(diff));
            return formatDate(sunday);
        }

        async function loadWeeklyNotes() {
            const dateInput = document.getElementById('weekly-notes-date');
            if (dateInput && dateInput.value) {
                currentWeekDate = dateInput.value;
            }

            const weekStart = getWeekStartDate(currentWeekDate);
            const weekStartFormatted = new Date(weekStart + 'T12:00:00').toLocaleDateString('en-US', { 
                month: 'long', day: 'numeric', year: 'numeric' 
            });
            
            document.getElementById('current-week-date').textContent = weekStartFormatted;

            const savedNotes = NOTES_DATA[weekStart];

			for (const field of weekNoteFields) {
				document.getElementById(field.key).value = savedNotes?.[field.key] || '';
			}

            loadPastWeeklyNotes();
        }

        async function saveWeeklyNotes() {
            const weekStart = getWeekStartDate(currentWeekDate);
            const storageKey = `weekly_notes_${weekStart}`;

            const notesData = {
                weekStart_sunday: weekStart,
                updated_at: new Date().toISOString()
            };
			
			for (const field of weekNoteFields) {
				notesData[field.key] = field.dataType === 'number' ? Number(document.getElementById(field.key).value) : document.getElementById(field.key).value;
			}

            const savedRecord = NOTES_DATA[weekStart];
			const newRecord = {
				recordId: savedRecord?.recordId,
				...notesData,
			}
			const [updatedRecord] = await AirtableService.upsertRecords(TABLES.WEEKLY_NOTES, [newRecord]);
			if (updatedRecord) {
				NOTES_DATA[updatedRecord.weekStart_sunday] = updatedRecord;
			}
            alert('âœ… Weekly notes saved!');
            loadPastWeeklyNotes();
        }

        async function loadPastWeeklyNotes() {
            const weeklyNotes = [];

			const dates = Object.keys(NOTES_DATA);
            for (const day of dates) {
				const record = NOTES_DATA[day];
                if (record) {
                    weeklyNotes.push(record);
                }
            }

            weeklyNotes.sort((a, b) => new Date(b.weekStart) - new Date(a.weekStart));
            const recent = weeklyNotes.slice(0, 8); // Show last 8 weeks

            const container = document.getElementById('past-weekly-notes');
            if (!container) return;

            if (recent.length === 0) {
                container.innerHTML = '<p style="color: #666;">No weekly notes saved yet. Start tracking this week!</p>';
                return;
            }

            container.innerHTML = recent.map(entry => {
                const weekDate = new Date(entry.weekStart_sunday + 'T12:00:00').toLocaleDateString('en-US', { 
                    month: 'long', day: 'numeric', year: 'numeric' 
                });
                return `
                    <div class="saved-journal">
                        <h4>Week of ${weekDate}</h4>
                        ${entry.energyBest ? `<p><strong>Best time:</strong> ${entry.energyBest}</p>` : ''}
                        ${entry.painLevel ? `<p><strong>Pain level:</strong> ${entry.painLevel}/10</p>` : ''}
                        ${entry.tremorLevel ? `<p><strong>Tremor severity:</strong> ${entry.tremorLevel}/10</p>` : ''}
                        ${entry.speechWins ? `<p><strong>Speech wins:</strong> ${entry.speechWins}</p>` : ''}
                        ${entry.ptImprovements ? `<p><strong>PT improvements:</strong> ${entry.ptImprovements}</p>` : ''}
                        ${entry.goal1 ? `<p><strong>Goals:</strong> ${entry.goal1}${entry.goal2 ? ', ' + entry.goal2 : ''}${entry.goal3 ? ', ' + entry.goal3 : ''}</p>` : ''}
                    </div>
                `;
            }).join('');
        }

        async function initializeNotes() {
			await loadNotesData();
        	setThisWeek();
		}
		initializeNotes();
    </script>
</body>
</html>